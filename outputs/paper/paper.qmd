---
title: "How Toronto's homeless death toll over the years shows the dangers of addiction's epidemic?"
subtitle: "Data analysis of homeless deaths in Toronto from 2017 to 2023"
author: 
  - Shipeng Zhang
thanks: "Code and data are available at: https://github.com/zero616/Homeless_Death_Analysis."
date: 2024-01-22
date-format: long
abstract: "Homelessness is a well-known problem in Toronto, and this article takes an in-depth look at the tragic reality of homelessness in Toronto. Focuses on the devastating impact of drug addiction by analyzing homeless death toll data from 2017 to 2023. Our top findings reveal a worrying rise in addiction-related homeless deaths over the years. By examining causes of death, age groups and gender, we provide a comprehensive overview revealing the dangers faced by this vulnerable group."
format: pdf
number-sections: true
bibliography: references.bib
editor: 
  markdown: 
    wrap: 72
---

```{r}
#| include: false
#| warning: false
#| message: false
library("janitor")
library("knitr")
library("lubridate")
library("opendatatoronto")
library("tidyverse")
```

# Introduction

Toronto is currently experiencing an escalating drug poisoning crisis,
with challenges posed by the Covid-19 pandemic further exacerbating the
public health dilemma. This article explores the details behind this
crisis through a comprehensive analysis of homeless deaths from 2017 to
2023.

Drug addiction has a profound impact on the homeless community. Our
result reveal the rapid spread of drug poisoning in Toronto. This
article takes an depth look at the proportion of deaths caused by drug
poisoning and sheds light on the impact of the COVID-19 pandemic on the
drug poisoning crisis.

To examine the impact of the COVID-19 pandemic on the drug poisoning
crisis, this article is divided into the following sections: data,
results, discussion, and conclusion. In the data section, I discuss the
nature of the spreadsheets obtained through the City of Toronto's
OpenDataToronto (Toronto Public Health 2023) and the steps I took to
clean and analyze the data. The Results section displays the trends
discovered during the analysis, and the Discussion section evaluates the
trends and provides insights. Finally, the conclusion summarizes the
main findings of this paper.

# Data {#sec-data}

The dataset used in this analysis was obtained from the City of
Toronto's OpenDataToronto Library (Gelfand 2022), adhering to ethical
guidelines and ensuring personal anonymity. It includes important
information such as year of death, cause of death, age group, gender and
number of people. To maintain transparency and reproducibility, all
analyzes were performed using the R programming language and visualized
with ggplot2 (Wickham 2016) and tables created with knit (Xie 2023).

Table 1 provides a summary of the dataset outlining the key variables
under consideration: time to death, cause of death, sex and age group.
The time of death started in 2017 and ended in 2023, and the age groups
were divided into \<20, 20-39, 40-59, 60+.

```{r}
#| warning: false
#| message: false
#| echo: false

file_path <- "../../inputs/data/raw_data.csv"
toronto_homeless_death <- read.csv(file_path)
toronto_homeless_death <- dplyr::select(toronto_homeless_death, -X_id)   
# Remove rows where 'Gender' is 'Unknown'
toronto_homeless_death <- toronto_homeless_death %>% filter(Gender != 'Unknown')
toronto_homeless_death <- toronto_homeless_death %>% filter(Age_group != 'Unknown')
# Remove rows where 'Cause_of_death' is 'Unknown' or 'Pending'
toronto_homeless_death <- toronto_homeless_death %>%
  filter(Cause_of_death != 'Unknown/Pending')

sample_data <- head(toronto_homeless_death, 6)
knitr::kable(sample_data,'markdown',col.names = c("Year of Death", "Cause of Death", "Age Group", "Gender", "Count"),align = 'c',
                      
                      caption = "Sample Table for Toronto Homeless Death")
  # Print the table

```

```{r}
total_count_age_data <- toronto_homeless_death %>%
  group_by(Age_group, Cause_of_death) %>%
  summarise(total_count_age = sum(Count), .groups = 'drop')
sample_total_count_by_age_data <- head(total_count_age_data, 6)
knitr::kable(sample_total_count_by_age_data,'markdown',col.names = c("Age Group", "Cause of Death", "Total Count"),align = 'c',
                      
                      caption = "Sample Table for total death number of causes of death by Age Group")
```

```{r}
total_count_data <- toronto_homeless_death %>%
  group_by(Year.of.death, Cause_of_death) %>%
  summarise(total_count = sum(Count), .groups = 'drop')
sample_total_count_by_year_data <- head(total_count_data, 6)
knitr::kable(sample_total_count_by_year_data,'markdown',col.names = c("Year of Death", "Cause of Death", "Total Count"),align = 'c',
                      
                      caption = "Sample Table for total death number of causes of death by Age Group")
```

Figure 1 shows the distribution of causes of death among homeless
people, stratified by age group. This figure provides an impactful
sketch of the leading causes of death among homeless people.

```{r}
#| label: fig-causes-of-death-by-age
#| fig-cap: Causes of death analysis by abe
#| warning: false
#| message: false
#| echo: false


ggplot(data = total_count_age_data,mapping =  aes(x = Cause_of_death,y =total_count_age, fill = Age_group)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("lightblue", "lightgreen", "lightpink", "lightyellow", "lightgray")) +
  labs(title = "Causes of Death Stacked by Age Group",
       x = "Cause of Death",
       y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#| label: fig-causes-of-death-by-year
#| fig-cap: Causes of death analysis by year
#| echo: false
#| warning: false
#| message: false
library(ggplot2)
library(dplyr)

# Assuming toronto_homeless_death is your dataset

# Aggregate the data to get the total count for each cause of death in each year


# Create a stacked bar chart
ggplot(data = total_count_data, aes(x = Year.of.death, y = total_count, fill = Cause_of_death)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("lightblue", "lightgreen", "lightpink", "lightyellow", "lightgray","black","orange","purple","yellow","red")) +
  labs(title = "Total Count of Causes of Death Stacked by Year",
       x = "Year of Death",
       y = "Death Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0))
```

```{r}
#| label: fig-rate-of-death
#| fig-cap: Rate of death Caused by Drug Toxicity Over Time
#| warning: false
#| message: false
#| echo: false
# Filter data for Drug Toxicity
drug_toxicity_data <- total_count_data %>%
  filter(Cause_of_death == "Drug Toxicity")

# Calculate the rate (percentage) of Drug Toxicity deaths for each year
rate_data <- total_count_data %>%
  group_by(Year.of.death) %>%
  summarise(total_deaths = sum(total_count),
            drug_toxicity_deaths = sum(total_count[Cause_of_death == "Drug Toxicity"]),
            rate = (drug_toxicity_deaths / total_deaths) * 100)  # Multiply by 100 to convert to percentage

# Create a line chart for the rate of Drug Toxicity deaths over time
ggplot(data = rate_data, aes(x = Year.of.death, y = rate)) +
  geom_line(color = "red",linewidth = 1.5) +
  geom_text(aes(label = sprintf("%.2f%%", rate)), vjust = -0.5, hjust = 0.5, size = 3) +
  labs(title = "Rate of Deaths Caused by Drug Toxicity Over Time",
       x = "Year of Death",
       y = "Rate (%)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0))
```

# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to
investigate... Background details and diagnostics are included in
[Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft.
Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both
measured in millimeters.

```{=tex}
\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}
```
We run the model in R [@citeR] using the `rstanarm` package of
@rstanarm. We use the default priors from `rstanarm`.

### Model justification

We expect a positive relationship between the size of the wings and time
spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance
$\theta$.

# Results

Our results are summarized in @tbl-modelresults. #\| echo: false #\|
eval: true #\| warning: false #\| message: false

library(rstanarm)

first_model \<- readRDS(file =
here::here("outputs/models/first_model.rds"))

```{r}

```

#\| echo: false #\| eval: true #\| label: tbl-modelresults #\| tbl-cap:
"Explanatory models of flight time based on wing width and wing length"
#\| warning: false

modelsummary::modelsummary( list( "First model" = first_model ),
statistic = "mad", fmt = 2 )

```{r}

```

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The
discussion is a chance to show off what you know and what you learnt
from all this.

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive
check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the
prior. This shows... #\| eval: true #\| echo: false #\| message: false
#\| warning: false #\| label: fig-ppcheckandposteriorvsprior #\|
layout-ncol: 2 #\| fig-cap: "Examining how the model fits, and is
affected by, the data" #\| fig-subcap: \["Posterior prediction check",
"Comparing the posterior with the prior"\]

pp_check(first_model) + theme_classic() + theme(legend.position =
"bottom")

posterior_vs_prior(first_model) + theme_minimal() +
scale_color_brewer(palette = "Set1") + theme(legend.position =
"bottom") + coord_flip()

```{r}

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests... #\|
echo: false #\| eval: true #\| message: false #\| warning: false #\|
label: fig-stanareyouokay #\| fig-cap: "Checking the convergence of the
MCMC algorithm" #\| fig-subcap: \["Trace plot", "Rhat plot"\] #\|
layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")

```{r}

```

\newpage

# References
